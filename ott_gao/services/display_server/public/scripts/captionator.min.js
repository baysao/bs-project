(function(){var A=10,F=16,I=4.5,J=1.5,N=[0,0,0,.5],e={};window.captionator=e;e.CaptionatorCueStructure=function(b,d){var a=this;this.isTimeDependent=!1;this.cueSource=b;this.options=d;this.processedCue=null;this.toString=function(c){if(!1!==d.processCueHTML){var e=function(b,d){if(null===a.processedCue){var f="",r,g;for(r in b)if(r.match(/^\d+$/)&&b.hasOwnProperty(r))if(g=b[r],g instanceof Object&&g.children&&g.children.length)"v"===g.token?f+='<q data-voice="'+g.voice.replace(/[\"]/g,"")+"\" class='voice speaker-"+
g.voice.replace(/[^a-z0-9]+/ig,"-").toLowerCase()+" webvtt-span' title=\""+g.voice.replace(/[\"]/g,"")+'">'+e(g.children,d+1)+"</q>":"c"===g.token?f+="<span class='webvtt-span webvtt-class-span "+g.classes.join(" ")+"'>"+e(g.children,d+1)+"</span>":0<g.timeIn?null===c||void 0===c||0<c&&c>=g.timeIn?f+="<span class='webvtt-span webvtt-timestamp-span' data-timestamp='"+g.token+"' data-timestamp-seconds='"+g.timeIn+"'>"+e(g.children,d+1)+"</span>":c<g.timeIn&&(f+="<span class='webvtt-span webvtt-timestamp-span webvtt-cue-future' aria-hidden='true' style='opacity: 0;' data-timestamp='"+
g.token+"' data-timestamp-seconds='"+g.timeIn+"'>"+e(g.children,d+1)+"</span>"):f+=g.rawToken+e(g.children,d+1)+"</"+g.token+">";else if(g instanceof String||"string"===typeof g||"number"===typeof g)f+=g;a.isTimeDependent||0!==d||(a.processedCue=f);return f}return a.processedCue};return e(this,0)}return b};this.getPlain=function(a){if(!1!==d.processCueHTML){var e=function(b,d){var f="",r,g;for(r in b)if(r.match(/^\d+$/)&&b.hasOwnProperty(r))if(g=b[r],g instanceof Object&&g.children&&g.children.length)if(0<
g.timeIn){if(null===a||void 0===a||0<a&&a>=g.timeIn)f+=e(g.children,d+1)}else f+=e(g.children,d+1);else if(g instanceof String||"string"===typeof g||"number"===typeof g)f+=g;return f};return e(this,0)}return b.replace(/<[^>]*>/ig,"")}};e.CaptionatorCueStructure.prototype=[];e.CTextTrack=function(b,d,a,c,h,l){this.onload=function(){};this.onerror=function(){};this.oncuechange=function(){};this.id=b||"";this.internalMode=e.CTextTrack.OFF;this.cues=new e.CTextTrackCueList(this);this.activeCues=new e.ActiveCTextTrackCueList(this.cues,
this);this.kind=d||"subtitles";this.label=a||"";this.language=c||"";this.src=h||"";this.readyState=e.CTextTrack.NONE;this.internalDefault=l||!1;this.getMode=function(){return this.internalMode};this.setMode=function(a){if(-1!==[e.CTextTrack.OFF,e.CTextTrack.HIDDEN,e.CTextTrack.SHOWING].indexOf(a))a!==this.internalMode&&(this.internalMode=a,this.readyState===e.CTextTrack.NONE&&0<this.src.length&&a>e.CTextTrack.OFF&&this.loadTrack(this.src,null),this.videoNode._captionator_dirtyBit=!0,e.rebuildCaptions(this.videoNode),
a===e.CTextTrack.OFF&&(this.cues.length=0,this.readyState=e.CTextTrack.NONE));else throw Error("Illegal mode value for track: "+a);};this.getDefault=function(){return this.internalDefault};Object.prototype.__defineGetter__?(this.__defineGetter__("mode",this.getMode),this.__defineSetter__("mode",this.setMode),this.__defineGetter__("default",this.getDefault)):Object.defineProperty&&(Object.defineProperty(this,"mode",{get:this.getMode,set:this.setMode}),Object.defineProperty(this,"default",{get:this.getDefault}));
this.loadTrack=function(a,b){var d,g=new XMLHttpRequest;if(this.readyState===e.CTextTrack.LOADED)b instanceof Function&&b(d);else{this.src=a;this.readyState=e.CTextTrack.LOADING;var c=this;g.open("GET",a,!0);g.onreadystatechange=function(a){4===g.readyState&&(200===g.status?(a=c.videoNode._captionatorOptions||{},"metadata"===c.kind&&(a.processCueHTML=!1,a.sanitiseCueHTML=!1),d=e.parseCaptions(g.responseText,a),c.readyState=e.CTextTrack.LOADED,c.cues.loadCues(d),c.activeCues.refreshCues.apply(c.activeCues),
c.videoNode._captionator_dirtyBit=!0,e.rebuildCaptions(c.videoNode),c.onload.call(this),b instanceof Function&&b.call(c,d)):(c.readyState=e.CTextTrack.ERROR,c.onerror()))};try{g.send(null)}catch(h){c.readyState=e.CTextTrack.ERROR,c.onerror(h)}}};this.addCue=function(a){if(a&&a instanceof e.CTextTrackCue)this.cues.addCue(a);else throw Error("The argument is null or not an instance of CTextTrackCue.");};this.removeCue=function(){}};e.CTextTrack.NONE=0;e.CTextTrack.LOADING=1;e.CTextTrack.LOADED=2;e.CTextTrack.ERROR=
3;e.CTextTrack.OFF=0;e.CTextTrack.HIDDEN=1;e.CTextTrack.SHOWING=2;e.CTextTrackCue=function(b,d,a,c,h,l,n){this.id=b;this.track=n instanceof e.CTextTrack?n:null;this.startTime=parseFloat(d);this.endTime=parseFloat(a)>=this.startTime?parseFloat(a):this.startTime;this.text="string"===typeof c||c instanceof e.CaptionatorCueStructure?c:"";this.settings="string"===typeof h?h:"";this.intSettings={};this.pauseOnExit=!!l;this.wasActive=!1;this.direction="horizontal";this.snapToLines=!0;this.linePosition="auto";
this.textPosition=50;this.size=0;this.alignment="middle";if(this.settings.length){var f=this.intSettings,r=this;h=h.split(/\s+/).filter(function(a){return 0<a.length});h instanceof Array&&h.forEach(function(a){var b={D:"direction",L:"linePosition",T:"textPosition",A:"alignment",S:"size"};a=a.split(":");b[a[0]]&&(f[b[a[0]]]=a[1]);b[a[0]]in r&&(r[b[a[0]]]=a[1])})}this.linePosition.match(/\%/)&&(this.snapToLines=!1);this.getCueAsSource=function(){return String(this.text)};this.getCueAsHTML=function(){var a=
document.createDocumentFragment(),b=document.createElement("div");b.innerHTML=String(this.text);Array.prototype.forEach.call(b.childNodes,function(b){a.appendChild(b.cloneNode(!0))});return a};this.isActive=function(){var a=0;if(this.track instanceof e.CTextTrack&&(this.track.mode===e.CTextTrack.SHOWING||this.track.mode===e.CTextTrack.HIDDEN)&&this.track.readyState===e.CTextTrack.LOADED)try{if(a=this.track.videoNode.currentTime,this.startTime<=a&&this.endTime>=a)return this.wasActive||(this.wasActive=
!0,this.onenter()),!0}catch(b){return!1}this.wasActive&&(this.wasActive=!1,this.onexit());return!1};Object.prototype.__defineGetter__?this.__defineGetter__("active",this.isActive):Object.defineProperty&&Object.defineProperty(this,"active",{get:this.isActive});this.toString=function(){return"CTextTrackCue:"+this.id+"\n"+String(this.text)};this.onenter=function(){};this.onexit=function(){}};e.CTextTrackCueList=function(b){this.cTrack=b instanceof e.CTextTrack?b:null;this.getCueById=function(b){return this.filter(function(a){return a.id===
b})[0]};this.loadCues=function(b){for(var a=0;a<b.length;a++)b[a].track=this.cTrack,Array.prototype.push.call(this,b[a])};this.addCue=function(b){if(b&&b instanceof e.CTextTrackCue){if(b.track!==this.cTrack&&b.track)throw Error("This cue is associated with a different track!");Array.prototype.push.call(this,b)}else throw Error("The argument is null or not an instance of CTextTrackCue.");};this.toString=function(){return"[CTextTrackCueList]"}};e.CTextTrackCueList.prototype=[];e.ActiveCTextTrackCueList=
function(b,d){this.refreshCues=function(){if(b.length){var a=this,c=!1,e=[].slice.call(this,0);this.length=0;b.forEach(function(b){b.active&&(a.push(b),a[a.length-1]!==e[a.length-1]&&(c=!0))});if(c)try{d.oncuechange()}catch(l){}}};this.toString=function(){return"[ActiveCTextTrackCueList]"};this.refreshCues()};e.ActiveCTextTrackCueList.prototype=new e.CTextTrackCueList(null);var P=function(b){this.targetObject=b;this.currentTime=0;this.addEventListener=function(b,a,c){"timeupdate"===b&&a instanceof
Function&&(this.timeupdateEventHandler=a)};this.attachEvent=function(b,a){"timeupdate"===b&&a instanceof Function&&(this.timeupdateEventHandler=a)};this.updateTime=function(b){isNaN(b)||(this.currentTime=b)}};e.rebuildCaptions=function(b){var d=b.currentTime,a=[],c=!1,h=[],l=[];(b.cTextTracks||[]).forEach(function(b,d){b.mode===e.CTextTrack.SHOWING&&b.readyState===e.CTextTrack.LOADED&&(l=[].slice.call(b.activeCues,0),l=l.sort(function(b,a){return b.startTime>a.startTime?-1:1}),a=a.concat(l))});h=
a.map(function(b){return b.track.id+"."+b.id+":"+b.text.toString(d).length});if((c=!e.compareArray(h,b._captionator_previousActiveCues))||b._captionator_dirtyBit)b._captionator_dirtyBit=!1,b._captionator_availableCueArea=null,b._captionator_previousActiveCues=h,e.styleCueCanvas(b),[].slice.call(b._descriptionContainerObject.getElementsByTagName("div"),0).concat([].slice.call(b._containerObject.getElementsByTagName("div"),0)).forEach(function(b){b.cueObject&&!b.cueObject.active&&(b.cueObject.rendered=
!1,b.cueObject.domNode=null,b.parentElement.removeChild(b))}),a.forEach(function(a){var c,h;"metadata"!==a.track.kind&&a.mode!==e.CTextTrack.HIDDEN&&(a.rendered?(c=a.domNode,h=c.getElementsByClassName("captionator-cue-inner")[0],a.text.toString(d)!==c.currentText&&(c.currentText=a.text.toString(d),h.innerHTML=c.currentText,h.spanified=!1)):(c=document.createElement("div"),h=document.createElement("span"),h.className="captionator-cue-inner",c.id=String(a.id).length?a.id:e.generateID(),c.className=
"captionator-cue",c.appendChild(h),c.cueObject=a,a.domNode=c,c.setAttribute("lang",a.track.language),c.currentText=a.text.toString(d),h.innerHTML=c.currentText,a.rendered=!0,"descriptions"===a.track.kind?b._descriptionContainerObject.appendChild(c):b._containerObject.appendChild(c)),"descriptions"!==a.track.kind&&e.styleCue(c,a,b))})};e.captionify=function(b,d,a){var c=[],h=0;a=a instanceof Object?a:{};a.minimumFontSize&&"number"===typeof a.minimumFontSize&&(A=a.minimumFontSize);a.minimumLineHeight&&
"number"===typeof a.minimumLineHeight&&(F=a.minimumLineHeight);a.fontSizeVerticalPercentage&&"number"===typeof a.fontSizeVerticalPercentage&&(I=a.fontSizeVerticalPercentage);a.lineHeightRatio&&"number"!==typeof a.lineHeightRatio&&(J=a.lineHeightRatio);a.cueBackgroundColour&&a.cueBackgroundColour instanceof Array&&(N=a.cueBackgroundColour);if(!(HTMLVideoElement||b instanceof P||a.forceCaptionify))return!1;if(b&&!1!==b&&void 0!==b&&null!==b)if(b instanceof Array)for(h=0;h<b.length;h++)"string"===typeof b[h]?
c=c.concat([].slice.call(document.querySelectorAll(b[h]),0)):b[h].constructor===HTMLVideoElement&&c.push(b[h]);else"string"===typeof b?c=[].slice.call(document.querySelectorAll(b),0):c.push(b);else c=[].slice.call(document.getElementsByTagName("video"),0);return c.length?(c.forEach(function(b){b.addCTextTrack=function(a,c,d,g,h,v,y){v="subtitles captions descriptions captions metadata chapters".split(" ");v.slice(0,7);a="string"===typeof a?a:"";d="string"===typeof d?d:"";g="string"===typeof g?g:"";
if(v.filter(function(a){return c===a?!0:!1}).length)return a=new e.CTextTrack(a,c,d,g,h,null),b.cTextTracks instanceof Array||(b.cTextTracks=[]),b.cTextTracks.push(a),a;throw e.createDOMException(12,"DOMException 12: SYNTAX_ERR: You must use a valid kind when creating a TimedCTextTrack.","SYNTAX_ERR");};e.processVideoElement(c[h],d,a)}),!0):!1};e.decaptionify=function(b){goog.dom.isElement(b._containerObject)&&(goog.dom.removeNode(b._containerObject),b._containerObject=null)};e.parseCaptions=function(b,
d){d=d instanceof Object?d:{};var a="",c=[],h="",l=[],n=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\,(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,f=/^(\d+)?:?(\d{2}):(\d{2})\.(\d+)\,(\d+)?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,r=/^(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)\s+\-\-\>\s+(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)\s*(.*)/,g=/(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)/,x=/^([\d\.]+)\s+\+([\d\.]+)\s*(.*)/,v=/^\[(\d{2})?:?(\d{2})\:(\d{2})\.(\d{2,3})\]\s*(.*?)$/,y=/^(DEFAULTS|DEFAULT)\s+\-\-\>\s+(.*)/g,C=/^(STYLE|STYLES)\s+\-\-\>\s*\n([\s\S]*)/g,
D=/^(COMMENT|COMMENTS)\s+\-\-\>\s+(.*)/g,p=/<tt\s+xml/ig,t=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)/;if(b){var z=function(a){var b=new e.CaptionatorCueStructure(a,d),c=[],h,f,k,n=[];k=0;var l=function(a){return!!a.replace(/[^a-z0-9]+/ig,"").length},c=a.split(/(<\/?[^>]+>)/ig);k=b;for(h in c)if(c.hasOwnProperty(h))if(f=c[h],"<"===f.substr(0,1))if("/"===f.substr(1,1)){if(a=f.substr(2).split(/[\s>]+/g)[0],0<n.length){f=0;for(k=n.length-1;0<=k;k--){var r=n[k][n[k].length-1];f=k;if(r.token===a)break}k=n[f];
n=n.slice(0,f)}}else{if(f.substr(1).match(g)||f.match(/^<v\s+[^>]+>/i)||f.match(/^<c[a-z0-9\-\_\.]+>/)||f.match(/^<(b|i|u|ruby|rt)>/)||!1!==d.sanitiseCueHTML){a={token:f.replace(/[<\/>]+/ig,"").split(/[\s\.]+/)[0],rawToken:f,children:[]};if("v"===a.token)a.voice=f.match(/^<v\s*([^>]+)>/i)[1];else if("c"===a.token)a.classes=f.replace(/[<\/>\s]+/ig,"").split(/[\.]+/ig).slice(1).filter(l);else if(f=a.rawToken.match(g))b.isTimeDependent=!0,f=f.slice(1),a.timeIn=parseInt(3600*(f[0]||0),10)+parseInt(60*
(f[1]||0),10)+parseInt(f[2]||0,10)+parseFloat("0."+(f[3]||0));k.push(a);n.push(k);k=a.children}}else!1!==d.sanitiseCueHTML&&(f=f.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\&/g,"&amp;"),d.ignoreWhitespace||(f=f.replace(/\n+/g,"<br />"))),k.push(f);return b},E=function(a){var b=0;if("string"!==typeof a)return 0;if(a=t.exec(a))a=a.slice(1),b=parseInt(3600*(a[0]||0),10)+parseInt(60*(a[1]||0),10)+parseInt(a[2]||0,10)+parseFloat("0."+(a[3]||0));return b},A=function(a,b){var c,f=0,g=0,f=String(a.getAttribute("begin"));
c=String(a.getAttribute("end"));var h=a.getAttribute("id")||b,f=E(f),g=E(c);c=!1===d.processCueHTML?a.innerHTML:z(a.innerHTML);return new e.CTextTrackCue(h,f,g,c,{},!1,null)},c=b.replace(/\r\n/g,"\n").replace(/\r/g,"\n");if(p.exec(b))return p=document.createElement("ttml"),p.innerHTML=b,[].slice.call(p.querySelectorAll("[begin],[end]"),0).map(A);b.split(/\n+/g).reduce(function(a,b,c,d){return a||!!v.exec(b)},!1)?(c=c.split(/\n+/g),a="LRC"):c=c.split(/\n\n+/g);c=c.filter(function(b){return b.match(/^WEBVTT(\s*FILE)?/ig)?
(a="WebVTT",!1):b.replace(/\s*/ig,"").length?!0:!1}).map(function(b,c){var g,p,t,k,m,w="",u;if(u=y.exec(b))return l=u.slice(2).join(""),l=l.split(/\s+/g).filter(function(a){return a&&!!a.length}),null;if(u=C.exec(b))return h+=u[u.length-1],null;if(u=D.exec(b))return null;for(g="LRC"===a?[b.substr(0,b.indexOf("]")+1),b.substr(b.indexOf("]")+1)]:b.split(/\n/g);!g[0].replace(/\s+/ig,"").length&&0<g.length;)g.shift();for(u=g[0].match(/^\s*[a-z0-9\-]+\s*$/ig)?String(g.shift().replace(/\s*/ig,"")):c;0<
g.length;){var q=g[0];if((m=r.exec(q))||(m=n.exec(q))||(m=f.exec(q)))m=m.slice(1),p=parseInt(3600*(m[0]||0),10)+parseInt(60*(m[1]||0),10)+parseInt(m[2]||0,10)+parseFloat("0."+(m[3]||0)),t=parseInt(3600*(m[4]||0),10)+parseInt(60*(m[5]||0),10)+parseInt(m[6]||0,10)+parseFloat("0."+(m[7]||0)),m[8]&&(w=m[8]);else if(m=x.exec(q))m=m.slice(1),p=parseFloat(m[0]),t=p+parseFloat(m[1]),m[2]&&(w=m[2]);else if(m=v.exec(q))m=m.slice(1,m.length-1),t=p=parseInt(3600*(m[0]||0),10)+parseInt(60*(m[1]||0),10)+parseInt(m[2]||
0,10)+parseFloat("0."+(m[3]||0));g=g.slice(0,0).concat(g.slice(1));break}if(!p&&!t)return null;m=l.reduce(function(a,b,c,d){a[b.split(":")[0]]=b.split(":")[1];return a},{});m=w.split(/\s+/g).filter(function(a){return a&&!!a.length}).reduce(function(a,b,c,d){a[b.split(":")[0]]=b.split(":")[1];return a},m);w="";for(k in m)m.hasOwnProperty(k)&&(w+=w.length?" ":"",w+=k+":"+m[k]);k=!1===d.processCueHTML?g.join("\n"):z(g.join("\n"));p=new e.CTextTrackCue(u,p,t,k,w,!1,null);p.styleData=h;return p}).filter(function(a){return null!==
a?!0:!1});"LRC"===a&&(c.forEach(function(a,b){var d=0,e;0<b&&(d=a.startTime,e=c[--b],e.endTime<d&&(e.endTime=d))}),c=c.filter(function(a){return 0<a.text.toString().replace(/\s*/,"").length?!0:!1}));return c}throw Error("Required parameter captionData not supplied.");};e.processVideoElement=function(b,d,a){var c=[],h=navigator.language||navigator.userLanguage,l=d||h.split("-")[0];a=a instanceof Object?a:{};b.captioned||(b._captionatorOptions=a,b.className+=(b.className.length?" ":"")+"captioned",
b.captioned=!0,0===b.id.length&&(b.id=e.generateID()),[].slice.call(b.querySelectorAll("track"),0).forEach(function(d){var f=null,f=0<d.querySelectorAll("source").length?d.querySelectorAll("source"):d.getAttribute("src"),f=b.addCTextTrack(d.getAttribute("id")||e.generateID(),d.getAttribute("kind"),d.getAttribute("label"),d.getAttribute("srclang").split("-")[0],f,d.getAttribute("type"),d.hasAttribute("default"));d.cTrack=f;f.trackNode=d;f.videoNode=b;c.push(f);var h=!1;"subtitles"!==f.kind&&"captions"!==
f.kind||l!==f.language||c.filter(function(a){return"captions"!==a.kind&&"subtitles"!==a.kind||l!==a.language||a.mode!==e.CTextTrack.SHOWING?!1:!0}).length||(h=!0);"chapters"===f.kind&&l===f.language&&(c.filter(function(a){return"chapters"===a.kind&&a.mode===e.CTextTrack.SHOWING?!0:!1}).length||(h=!0));"descriptions"===f.kind&&!0===a.enableDescriptionsByDefault&&l===f.language&&(c.filter(function(a){return"descriptions"===a.kind&&a.mode===e.CTextTrack.SHOWING?!0:!1}).length||(h=!0));!0===h&&c.forEach(function(a){a.trackNode.hasAttribute("default")&&
a.mode===e.CTextTrack.SHOWING&&(a.mode=e.CTextTrack.HIDDEN)});d.hasAttribute("default")&&!c.filter(function(a){return a.trackNode.hasAttribute("default")&&a.trackNode!==d?!0:!1}).length&&(h=!0,f.internalDefault=!0);!0===h&&(f.mode=e.CTextTrack.SHOWING)}),b.addEventListener("timeupdate",function(b){b=b.target;try{b.cTextTracks.forEach(function(a){a.activeCues.refreshCues.apply(a.activeCues)})}catch(c){}a.renderer instanceof Function?a.renderer.call(e,b):e.rebuildCaptions(b)},!1),window.addEventListener("resize",
function(a){b._captionator_dirtyBit=!0;e.rebuildCaptions(b)},!1),!0===a.enableHighResolution&&window.setInterval(function(){try{b.cTextTracks.forEach(function(a){a.activeCues.refreshCues.apply(a.activeCues)})}catch(c){}a.renderer instanceof Function?a.renderer.call(e,b):e.rebuildCaptions(b)},20));return b};e.getNodeMetrics=function(b){for(var d=window.getComputedStyle(b,null),a=b,c=b.offsetTop,e=b.offsetLeft,l=b,n=0,f=0,l=parseInt(d.getPropertyValue("width"),10),n=parseInt(d.getPropertyValue("height"),
10);a=a.offsetParent;)c+=a.offsetTop,e+=a.offsetLeft;b.hasAttribute("controls")?(b=navigator.userAgent.toLowerCase(),-1!==b.indexOf("chrome")?f=32:-1!==b.indexOf("opera")?f=25:-1!==b.indexOf("firefox")?f=28:-1!==b.indexOf("ie 9")||-1!==b.indexOf("ipad")?f=44:-1!==b.indexOf("safari")&&(f=25)):b._captionatorOptions&&(b=b._captionatorOptions,b.controlHeight&&(f=parseInt(b.controlHeight,10)));return{left:e,top:c,width:l,height:n,controlHeight:f}};e.applyStyles=function(b,d){for(var a in d)({}).hasOwnProperty.call(d,
a)&&(b.style[a]=d[a])};e.checkDirection=function(b){var d=RegExp("^[^\u0591-\u07ff\ufb1d-\ufdfd\ufe70-\ufefc]*[A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufdfe-\ufe6f\ufefd-\uffff]");return RegExp("^[^A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufdfe-\ufe6f\ufefd-\uffff]*[\u0591-\u07ff\ufb1d-\ufdfd\ufe70-\ufefc]").test(b)?"rtl":d.test(b)?"ltr":""};e.styleCue=function(b,d,a){var c=0,h=0,l=0,n=0,f,r,g=0,x=0,v,y,C,D,p,
t,z=0,E=f=c=0,L=0,G=0,K,H,B=0,O=a._captionatorOptions||{},k,h=50,c=g=0,h=!0;f="";var m,w=function(a){if(a.spanified)return a.characterCount;var b=function(a){return!!a.length},c,d,f,h,g=0,k=function(a){g++;e.applyStyles(a,{display:"block",lineHeight:"auto",height:v+"px",width:t+"px",textAlign:"center"})};for(c in a.childNodes)a.childNodes.hasOwnProperty(c)&&!a.childNodes[c].nospan&&(d=a.childNodes[c],3===d.nodeType?(h=document.createDocumentFragment(),f=d.nodeValue,h.appendChild(document.createElement("span")),
h.childNodes[0].innerHTML="<span class='captionator-cue-character'>"+f.split(/(.)/).filter(b).join("</span><span class='captionator-cue-character'>")+"</span>",[].slice.call(h.querySelectorAll("span.captionator-cue-character"),0).forEach(k),d.parentNode.replaceChild(h,d)):1===a.childNodes[c].nodeType&&(g+=w(a.childNodes[c])));a.characterCount=g;a.spanified=!0;return g};k=e.getNodeMetrics(a);a._captionator_availableCueArea||(a._captionator_availableCueArea={bottom:k.height-k.controlHeight,right:k.width,
top:0,left:0,height:k.height-k.controlHeight,width:k.width});"horizontal"===d.direction&&(e.applyStyles(b,{width:"auto",position:"static",display:"inline-block",padding:"1em"}),g=parseInt(b.offsetWidth,10),c=Math.floor(g/a._captionator_availableCueArea.width*100),c=100>=c?c:100);g=I/100*k.height/96*72;g=g>=A?g:A;v=Math.floor(g/72*96);y=Math.floor(g*J);y=y>F?y:F;t=p=Math.ceil(y/72*96);p*Math.floor(k.height/p)<k.height&&(p=Math.floor(k.height/Math.floor(k.height/p)),y=Math.ceil(p/96*72));p*Math.floor(k.width/
p)<k.width&&(t=Math.ceil(k.width/Math.floor(k.width/p)));C=Math.floor(a._captionator_availableCueArea.height/p);D=Math.floor(a._captionator_availableCueArea.width/t);0===parseFloat(String(d.size).replace(/[^\d\.]/ig,""))?!0===O.sizeCuesByTextBoundingBox?f=c:(f=100,h=!1):(h=!1,f=parseFloat(String(d.size).replace(/[^\d\.]/ig,"")),f=100>=f?f:100);g="horizontal"===d.direction?Math.floor(.01*k.width):0;x="horizontal"===d.direction?0:Math.floor(.01*k.height);"auto"===d.linePosition?d.linePosition="horizontal"===
d.direction?C:D:String(d.linePosition).match(/\%/)&&(d.snapToLines=!1,d.linePosition=parseFloat(String(d.linePosition).replace(/\%/ig,"")));"horizontal"===d.direction?(n=p,"auto"!==d.textPosition&&h&&(h=parseFloat(String(d.textPosition).replace(/[^\d\.]/ig,"")),f=f-h>c?f-h:c),l=!0===d.snapToLines?f/100*a._captionator_availableCueArea.width:f/100*k.width,"auto"===d.textPosition?c=(a._captionator_availableCueArea.right-l)/2+a._captionator_availableCueArea.left:(h=parseFloat(String(d.textPosition).replace(/[^\d\.]/ig,
"")),c=h/100*(a._captionator_availableCueArea.right-l)+a._captionator_availableCueArea.left),!0===d.snapToLines?h=(C-1)*p+a._captionator_availableCueArea.top:(h=k.controlHeight+p+2*x,h=d.linePosition/100*(k.height-h))):(h=a._captionator_availableCueArea.top,c=a._captionator_availableCueArea.right-t,l=t,n=f/100*a._captionator_availableCueArea.height,c=w(b),f=[].slice.call(b.querySelectorAll("span.captionator-cue-character"),0),z=Math.floor((n-2*x)/v),l=Math.ceil(c/z)*t,E=Math.ceil(c/z),L=(c-z*(E-1))*
v,!0===d.snapToLines?c="vertical-lr"===d.direction?a._captionator_availableCueArea.left:a._captionator_availableCueArea.right-l:(c=l+2*g,c="vertical-lr"===d.direction?d.linePosition/100*(k.width-c):k.width-c-d.linePosition/100*(k.width-c)),"auto"===d.textPosition?h=(a._captionator_availableCueArea.bottom-n)/2+a._captionator_availableCueArea.top:(d.textPosition=parseFloat(String(d.textPosition).replace(/[^\d\.]/ig,"")),h=d.textPosition/100*(a._captionator_availableCueArea.bottom-n)+a._captionator_availableCueArea.top),
H=K=B=G=0,f.forEach(function(a,b){K="vertical-lr"===d.direction?t*G:l-t*(G+1);"start"===d.alignment||"start"!==d.alignment&&G<E-1?H=B*v+x:"end"===d.alignment?H=B*v-v+(n+2*x-L):"middle"===d.alignment&&(H=(n-2*x-L)/2+B*v);a.setAttribute("aria-hidden","true");e.applyStyles(a,{position:"absolute",top:H+"px",left:K+"px"});B>=z-1?(B=0,G++):B++}),b.accessified||(f=d.text.getPlain(a.currentTime),m=document.createElement("div"),m.innerHTML=f,m.nospan=!0,b.appendChild(m),b.accessified=!0,e.applyStyles(m,{position:"absolute",
overflow:"hidden",width:"1px",height:"1px",opacity:"0",textIndent:"-999em"})));"horizontal"===d.direction&&(r="rtl"===e.checkDirection(String(d.text))?{start:"right",middle:"center",end:"left"}[d.alignment]:{start:"left",middle:"center",end:"right"}[d.alignment]);e.applyStyles(b,{overflow:"hidden",width:l+"px",height:n+"px",left:c+"px",padding:x+"px "+g+"px",textAlign:r,backgroundColor:"rgba("+N.join(",")+")",direction:e.checkDirection(String(d.text)),lineHeight:y+"pt",boxSizing:"border-box"});if("vertical"===
d.direction||"vertical-lr"===d.direction)c-a._captionator_availableCueArea.left-a._captionator_availableCueArea.left>=a._captionator_availableCueArea.right-(c+l)?a._captionator_availableCueArea.right=c:a._captionator_availableCueArea.left=c+l,a._captionator_availableCueArea.width=a._captionator_availableCueArea.right-a._captionator_availableCueArea.left;else{if(b.scrollHeight>1.2*b.offsetHeight){if(d.snapToLines){for(r=0;b.scrollHeight>1.2*b.offsetHeight;)n+=p,b.style.height=n+"px",r++;h-=r*p}else n=
b.scrollHeight+x,h=k.controlHeight+n+2*x,h=d.linePosition/100*(k.height-h),b.style.height=n+"px";b.style.top=h+"px"}h-a._captionator_availableCueArea.top-a._captionator_availableCueArea.top>=a._captionator_availableCueArea.bottom-(h+n)&&a._captionator_availableCueArea.bottom>h?a._captionator_availableCueArea.bottom=h:a._captionator_availableCueArea.top<h+n&&(a._captionator_availableCueArea.top=h+n);a._captionator_availableCueArea.height=a._captionator_availableCueArea.bottom-a._captionator_availableCueArea.top}if(O.debugMode){var u,
q,M=function(){u||(a._captionatorDebugCanvas?(u=a._captionatorDebugCanvas,q=a._captionatorDebugContext):(u=document.createElement("canvas"),u.setAttribute("width",k.width),u.setAttribute("height",k.height-k.controlHeight),document.body.appendChild(u),e.applyStyles(u,{position:"absolute",top:k.top+"px",left:k.left+"px",width:k.width+"px",height:k.height-k.controlHeight+"px",zIndex:3E3}),q=u.getContext("2d"),a._captionatorDebugCanvas=u,a._captionatorDebugContext=q))};M();u.setAttribute("width",k.width);
M();q.fillStyle="rgba(100,100,255,0.5)";q.fillRect(a._captionator_availableCueArea.left,a._captionator_availableCueArea.top,a._captionator_availableCueArea.right,a._captionator_availableCueArea.bottom);q.stroke();(function(){var b;M();q.strokeStyle="rgba(255,0,0,0.5)";q.lineWidth=1;q.beginPath();for(b=0;b<C;b++)q.moveTo(.5,b*p+.5),q.lineTo(k.width,b*p+.5);q.closePath();q.stroke();q.beginPath();q.strokeStyle="rgba(0,255,0,0.5)";for(b=D;0<=b;b--)q.moveTo(k.width-b*t-.5,-.5),q.lineTo(k.width-b*t-.5,
k.height);q.closePath();q.stroke();q.beginPath();q.strokeStyle="rgba(255,255,0,0.5)";for(b=0;b<=D;b++)q.moveTo(b*t+.5,-.5),q.lineTo(b*t+.5,k.height);q.stroke();a.linesDrawn=!0})()}};e.styleCueCanvas=function(b){var d,a,c,h;d=b._captionatorOptions instanceof Object?b._captionatorOptions:{};b._containerObject&&(a=b._containerObject);b._descriptionContainerObject&&(c=b._descriptionContainerObject);c?c.parentNode||document.body.appendChild(c):(c=document.createElement("div"),c.className="captionator-cue-descriptive-container",
h=e.generateID(),c.id=h,b._descriptionContainerObject=c,c.setAttribute("aria-live","polite"),c.setAttribute("aria-atomic","true"),c.setAttribute("role","region"),document.body.appendChild(c),e.applyStyles(c,{position:"absolute",overflow:"hidden",width:"1px",height:"1px",opacity:"0",textIndent:"-999em"}));if(a)a.parentNode||document.body.appendChild(a);else{a=document.createElement("div");a.className="captionator-cue-canvas";c=e.generateID();a.id=c;if(d.appendCueCanvasTo){c=null;if(d.appendCueCanvasTo instanceof
HTMLElement)c=d.appendCueCanvasTo;else if("string"===typeof d.appendCueCanvasTo)try{var l=document.querySelectorAll(d.appendCueCanvasTo);if(0<l.length)c=l[0];else throw null;}catch(n){c=document.body,d.appendCueCanvasTo=!1}else c=document.body,d.appendCueCanvasTo=!1;c.appendChild(a)}else document.body.appendChild(a);b._containerObject=a}l=e.getNodeMetrics(b);b=I/100*l.height/96*72;b=b>=A?b:A;d=Math.floor(b*J);d=d>F?d:F;e.applyStyles(a,{position:"absolute",zIndex:100,height:"auto",width:l.width+"px",
bottom:"40px",color:"white",fontFamily:"Verdana, Helvetica, Arial, sans-serif",fontSize:b+"pt",lineHeight:d+"pt",boxSizing:"border-box"})};e.createDOMException=function(b,d,a){try{document.querySelectorAll("div/[]")}catch(e){var c=function(a,b,c){this.code=a;this.message=b;this.name=c};c.prototype=e;return new c(b,d,a)}};e.compareArray=function(b,d){if(!(b instanceof Array&&d instanceof Array)||b.length!==d.length)return!1;for(var a in b)if(b.hasOwnProperty(a)&&b[a]!==d[a])return!1;return!0};e.generateID=
function(b){var d="";for(b=b?b:10;d.length<b;)d+=String.fromCharCode(65+Math.floor(26*Math.random()));return"captionator"+d};e.showTrackByIndex=function(b,d){(b.cTextTracks||[]).forEach(function(a,b){a.mode=b==d?e.CTextTrack.SHOWING:e.CTextTrack.OFF});e.rebuildCaptions(b)}})();

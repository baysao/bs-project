videojs.plugin("youbora",function(e){var r=this,t=this.id(),a=e,o="";o="undefined"==typeof youboraDataMap?youboraData:youboraDataMap.get(t);var n=o.getDebug(),i=o.getLive(),c={username:o.getUsername(),interval:6e3},s="PC-VIDEOJS",l="VIDEOJS",u="3.4.3_videojs";r.mediainfo&&(s="PC-VIDEOJS-BCOVE",l="BCOVE",u="3.4.3_bcove");var d=0,g="",m=1,f={BUFFER_BEGIN:1,BUFFER_END:0,JOIN_SEND:2},p=this,y=void 0,b=void 0,P=void 0,h=0,E=0,B=!1,S=!1,v=!1,R=!1,N=!1,k=!1,w=!1,T=!1,D=!1,C=!1,x=!1,L=!1,F=!1,U=0,I=0,_=0,M=0,O=0,j=0,W="",A="",G=!1,J=0,H=.1,V={},Y=0,q={1:"11100",2:"11101",3:"11102",4:"11103",5:"11104",unknown:"11105","-1":"11106","-2":"11107"};this.youbora={Check:function(){console.log("i am "),console.log(r)},Init:function(){d=!0,r.youbora.startPlugin()},getYouboraData:function(){return o},setBcoveProperties:function(e){try{!B&&(E===1/0||0>E)&&o.setLive(!0)}catch(t){}try{r.mediainfo&&(e.properties||(e.properties=""),e.properties.content_metadata||(e.properties={content_metadata:""}),e.properties.content_metadata={title:r.mediainfo.name,duration:r.mediainfo.duration})}catch(t){}return e},setProperties:function(e){o.setAccountCode(e.accountCode),"undefined"!=typeof e.username&&o.setUsername(e.username),"undefined"!=typeof e.isLive&&(B=!0,o.setLive(e.isLive)),e.debug&&(o.debug=e.debug,n=e.debug),e.properties&&o.setProperties(e.properties),e.contentId&&o.setContentId(e.contentId),e.transaction&&o.setTransaction(e.transaction),e.httpSecure&&o.setHttpSecure(e.httpSecure),e.isp&&o.setISP(e.isp),e.cdn&&o.setCDN(e.cdn),e.ip&&o.setIP(e.ip),e.CDNNodeData&&o.setCDNNodeData(e.CDNNodeData),e.parseHLS&&o.setParseHLS(e.parseHLS),e.extraparam1&&o.setExtraParam(1,e.extraparam1),e.extraparam2&&o.setExtraParam(2,e.extraparam2),e.extraparam3&&o.setExtraParam(3,e.extraparam3),e.extraparam4&&o.setExtraParam(4,e.extraparam4),e.extraparam5&&o.setExtraParam(5,e.extraparam5),e.extraparam6&&o.setExtraParam(6,e.extraparam6),e.extraparam7&&o.setExtraParam(7,e.extraparam7),e.extraparam8&&o.setExtraParam(8,e.extraparam8),e.extraparam9&&o.setExtraParam(9,e.extraparam9),e.extraparam10&&o.setExtraParam(10,e.extraparam10),e.balanceProperties&&(e.balanceProperties.enabled=!1,o.setBalanceProperties(e.balanceProperties)),e.concurrencyProperties&&o.setConcurrencyProperties(e.concurrencyProperties),e.resumeProperties&&o.setResumeProperties(e.resumeProperties),e.username&&(c.username=e.username)},startPlugin:function(){try{try{if(p=r,E=r.duration(),(isNaN(E)||"NaN"==E||NaN==E||E==1/0)&&(E=0),n&&console.log("SmartPlugin :: "+l+" :: startPlugin :: HTML5 <video> found!"),W=p.currentSrc(),o.setMediaResource(W),P=new YouboraCommunication(o.getAccountCode(),o.getService(),c,u,s,t),r.youbora.bindEvents(),k&&(P.sendResume(),k=!1),o.getBalanceEnabled()&&P.enableBalancer&&(o.setBalancedResource(!0),""===g)){var e=P.getResourcePath(W);P.getBalancedResource(e,function(e){setBalancedResource(e)})}}catch(a){n&&(console.log(a),console.log("SmartPlugin :: "+l+" :: startPlugin :: No <video> found!"))}}catch(a){n&&console.log("SmartPlugin :: "+l+" :: startPlugin :: Error: "+a)}},bindEvents:function(){try{for(var e=["canplay","playing","waiting","timeupdate","ended","play","pause","error","abort","seeking","seeked","stalled","suspend","progress","dispose","loadeddata","loadstart","adstart","adend"],t=0;t<e.length;t++)p.on(e[t],function(e){r.youbora.checkPlayState(e)});n&&console.log("SmartPlugin :: "+l+" :: bindEvents :: Events atached correctly!")}catch(a){n&&console.log("SmartPlugin :: "+l+" :: bindEvents :: Error: "+a)}},unbindEvents:function(){try{var e=["canplay","playing","waiting","timeupdate","ended","play","pause","error","abort","seeking","seeked","stalled","suspend","progress","dispose","loadeddata","loadstart","adstart","adend"];for(elem in e)p.off(e[elem],function(e){})}catch(r){n&&console.log("SmartPlugin :: "+l+" :: bindEvents :: Error: "+r)}},isAd:function(e){n&&console.log("SmartPlugin :: "+l+" :: isAd :: "+e),w=e},checkPlayState:function(e){switch(n&&console.log("DEBUG: SmartPlugin :: "+l+" :: checkPlayState :: "+e.type),e.type){case"timeupdate":try{w||(R&&!N&&(C||T)&&r.youbora.setBufferEvent(f.BUFFER_END),y=p.currentSrc(),h=p.currentTime(),h>0&&U+H<p.currentTime()&&r.youbora.checkBuffering())}catch(t){n&&console.log("SmartPlugin :: "+l+" :: timeupdate :: Error: "+t)}break;case"play":try{N||this.setBufferEvent(f.BUFFER_BEGIN),w||A||(y=p.currentSrc(),E=p.duration(),R||null!=p.error()||((""===o.getMediaResource()||null===o.getMediaResource()||"function"==typeof p.playlist&&p.playlist().length>0)&&o.setMediaResource(p.currentSrc()),E=p.duration(),!B&&(E===1/0||0>E)&&o.setLive(!0),(isNaN(E)||"NaN"==E||NaN==E||E==1/0)&&(E=0),a=r.youbora.setBcoveProperties(a),r.youbora.setProperties(a),P.sendStart(0,window.location.href,"",o.getLive(),o.getMediaResource(),E,o.getTransaction()),r.youbora.setPing(),r.youbora.setBufferChecker(),R=!0),k&&(P.sendResume(),k=!1))}catch(t){n&&console.log("SmartPlugin :: "+l+" :: play :: Error: "+t)}break;case"playing":try{R&&!w&&(r.youbora.checkBuffering(),k&&(P.sendResume(),k=!1)),D=!0}catch(t){n&&console.log("SmartPlugin :: "+l+" :: playing :: Error: "+t)}break;case"canplay":try{R&&!w&&(C=!0)}catch(t){n&&console.log("SmartPlugin :: "+l+" :: canplay :: Error: "+t)}break;case"adstart":try{r.youbora.isAd(!0);var i=new Date;O=i.getTime()}catch(t){n&&console.log("SmartPlugin :: "+l+" :: adstart :: Error: "+t)}break;case"adend":try{x=!0,r.youbora.isAd(!1);var i=new Date;j=i.getTime()-O}catch(t){n&&console.log("SmartPlugin :: "+l+" :: adend :: Error: "+t)}break;case"pause":try{w||A||(R&&P.sendPause(),k=!0)}catch(t){n&&console.log("SmartPlugin :: "+l+" :: pause :: Error: "+t)}break;case"ended":try{R&&!w&&r.youbora.reset()}catch(t){n&&console.log("SmartPlugin :: "+l+" :: ended :: Error: "+t)}break;case"abort":try{R&&!w&&"undefined"!=typeof window.orientation&&r.youbora.reset()}catch(t){n&&console.log("SmartPlugin :: "+l+" :: abort :: Error: "+t)}break;case"error":try{if(a=r.youbora.setBcoveProperties(a),o.getBalanceEnabled()&&P.enableBalancer)n&&console.log("SmartPlugin :: "+l+" :: playerError :: Balancing..."),S=!0,P.sendErrorWithParameters("131"+getBalancerErrorCount(),"CDN_PLAY_FAILURE",0,window.location.href,a,o.getLive(),g[m].URL,p.duration()),m++,r.youbora.refreshBalancedResource();else{var t="3001",c="";try{t=p.error().code,(null!==t||void 0!==t)&&(t=q[t]),void 0==t&&(t="3001"),c=p.error().message,(""===c||null===c)&&(c=p.error().type)}catch(e){console.log(e)}S=!0,r.youbora.checkBuffering(),clearInterval(b),(""===o.getMediaResource()||null===o.getMediaResource())&&o.setMediaResource(p.currentSrc()),P.sendErrorWithParameters(t,c,0,window.location.href,a,o.getLive(),youboraData.getMediaResource(),p.duration()),r.youbora.reset()}}catch(t){n&&console.log("SmartPlugin :: "+l+" :: error :: Error: "+t)}break;case"progress":try{R&&(T=!0)}catch(t){n&&console.log("SmartPlugin :: "+l+" :: progress :: Error: "+t)}break;case"waiting":try{w||A||v===!1&&(r.youbora.setBufferEvent(f.BUFFER_BEGIN),v=!0)}catch(t){n&&console.log("SmartPlugin :: "+l+" :: waiting :: Error: "+t)}break;case"seeking":!w&&R&&(A=!0,v=!1,G=!0,J=(new Date).getTime());break;case"seeked":w||(A=!1,v=!1);break;case"stalled":try{L=!0}catch(t){n&&console.log("SmartPlugin :: "+l+" :: isStalledFired :: Error: "+t)}break;case"dispose":r.youbora.unLoad();break;case"loadstart":try{R&&!w&&("undefined"==typeof window.orientation&&r.youbora.reset(),N||this.setBufferEvent(f.BUFFER_BEGIN))}catch(t){n&&console.log("SmartPlugin :: "+l+" :: playing :: Error: "+t)}break;case"loadeddata":try{F=!0,!R&&!N&&r.playlist().length>0&&(r.youbora.setBufferEvent(f.BUFFER_END),R||null!=p.error()||((""===o.getMediaResource()||null===o.getMediaResource()||"function"==typeof p.playlist&&p.playlist().length>0)&&o.setMediaResource(p.currentSrc()),E=p.duration(),!B&&(E===1/0||0>E)&&o.setLive(!0),(isNaN(E)||"NaN"==E||NaN==E||E==1/0)&&(E=0),a=r.youbora.setBcoveProperties(a),r.youbora.setProperties(a),P.sendStart(0,window.location.href,"",o.getLive(),resource,E,o.getTransaction()),r.youbora.setPing(),r.youbora.setBufferChecker(),R=!0))}catch(t){n&&console.log("SmartPlugin :: "+l+" :: loadeddata :: Error: "+t)}break;case"buffered":break;case"bufferedEnd":}},setBufferChecker:function(){V=setTimeout(function(){r.youbora.bufferChecker()},300)},bufferChecker:function(){try{if(p.currentTime()>0&&!v&&!k&&!A){(new Date).getTime();U>=p.currentTime()&&p.currentTime()<p.duration()&&(Y++,Y>=2&&(r.youbora.setBufferEvent(f.BUFFER_BEGIN),v=!0,Y=0))}}catch(e){console.log(e)}clearTimeout(V),U=p.currentTime(),r.youbora.setBufferChecker()},getBalancerErrorCount:function(){return 10>m?"0"+m:m>10?m:"00"},refreshBalancedResource:function(){try{"undefined"!=typeof g[m]?(p.src(g[m].URL),setTimeout(function(){p.load()},50),p.load()):(o.setBalanceEnabled(!1),p.src(W),setTimeout(function(){p.load()},50),n&&console.log("SmartPlugin :: "+l+" :: Balancer :: End of mirrors"))}catch(e){n&&console.log("SmartPlugin :: "+l+" :: Balancer :: Error :: End of mirrors error:"+e)}},setBalancedResource:function(e){try{if(e!==!1){var r=0;for(index in e)r++;if(g=e,g[""+(r+1)]=new Object,g[""+(r+1)].URL=o.getMediaResource(),"undefined"!=typeof e[1].URL)if(n&&(console.log("SmartPlugin :: "+l+" :: Balance Current Resource  :: "+y),console.log("SmartPlugin :: "+l+" :: Balance Priority Resource :: "+e[1].URL)),e[1].URL!=W){n&&console.log("SmartPlugin :: "+l+" :: Balancing :: "+e[1].URL);try{p.src(e[1].URL),o.setCDN(e[1].CDN_CODE),p.pause(),p.load()}catch(t){n&&console.log("SmartPlugin :: "+l+" :: Balancing :: Error While Changing Media: "+t),p.src(e[1].URL),p.load()}}else n&&console.log("SmartPlugin :: "+l+" :: Balancer :: Same Resource"),o.setBalanceEnabled(!1),p.src(W),p.load();else n&&console.log("SmartPlugin :: "+l+" :: Invalid balance object"),p.load()}else n&&console.log("SmartPlugin :: "+l+" :: Balance unavailable with current parameters"),g="false",p.load()}catch(t){n&&console.log("SmartPlugin :: "+l+" :: setBalancedResource :: Error: "+t)}},checkBuffering:function(){try{v&&R&&N&&(r.youbora.setBufferEvent(f.BUFFER_END),Y=0,v=!1)}catch(e){n&&console.log("SmartPlugin :: "+l+" :: checkBuffering :: Error: "+e)}},setBufferEvent:function(e){try{var r=new Date,t=0,a=0;switch(e){case f.BUFFER_BEGIN:I=r.getTime(),0===_&&(_=r.getTime());break;case f.BUFFER_END:if(t=r.getTime(),a=t-I,0==N){var o=r.getTime()-_-j;R&&(E=p.duration(),P.sendJoinWithMediaDuration(h,o,E),N=!0),n&&console.log("SmartPlugin :: "+l+" :: setBufferEvent :: sendJoin")}else{var c=(new Date).getTime();(!G||G&&c-J>1e4)&&(0===h&&i&&(h=10),A?n&&console.log("SmartPlugin :: "+l+" :: setBufferEvent :: sendSeek"):(R&&a>=100&&P.sendBuffer(h,a),n&&console.log("SmartPlugin :: "+l+" :: setBufferEvent :: sendBuffer"))),G=!1,J=0,c=0}v=!1}}catch(s){n&&console.log("SmartPlugin :: "+l+" :: setBufferEvent :: Error: "+s)}},setPing:function(){try{b=setTimeout(function(){r.youbora.ping()},P.getPingTime())}catch(e){n&&console.log("SmartPlugin :: "+SmartPlugin.pluginName+" :: setPing :: Error: "+e)}},ping:function(){try{clearTimeout(b);var e=this.getCurrentBitrate();this.getCurrentBandwidth();b=null,r.youbora.setPing(),R&&P.sendPingTotalBitrate(e,h)}catch(t){n&&console.log("SmartPlugin :: "+l+" :: Ping :: Error: "+t)}},getCurrentBitrate:function(){try{return r.hls?r.hls.playlists.media().attributes.BANDWIDTH:-1}catch(e){n&&console.log("SmartPlugin :: "+l+" :: getCurrentBitrate :: Error: "+e)}},getCurrentBandwidth:function(){try{return r.hls?r.hls.bandwidth:-1}catch(e){n&&console.log("SmartPlugin :: "+l+" :: getCurrentBandwidth :: Error: "+e)}},defineWatch:function(){try{Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(e,r){var t=this[e],a=t,o=function(){return a},n=function(o){return t=a,a=r.call(this,e,t,o)};delete this[e]&&Object.defineProperty(this,e,{get:o,set:n,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(e){var r=this[e];delete this[e],this[e]=r}}),setWatch()}catch(e){n&&console.log("SmartPlugin :: "+l+" :: defineWatch :: Error: "+e)}},setWatch:function(){try{var e=["balanceObject","balanceIndex","videoPlayer","urlResource","currentTime","isStreamError","isBuffering","isStartSent","isJoinSent","isPaused","bufferTimeBegin","joinTimeBegin","joinTimeEnd"];for(elem in e)"function"!=typeof e[elem]&&watch(e[elem],function(e,r,t){return console.log("SmartPlugin :: "+l+" :: Watcher :: ["+e+"] From: ["+r+"] To: ["+t+"]"),t})}catch(r){n&&console.log("SmartPlugin :: "+l+" :: setWatch :: Error: "+r)}},reset:function(){try{F=!1,C=!1,T=!1,clearTimeout(b),clearTimeout(V),P.sendStop(),h=0,y="",i=o.getLive(),E=0,U=0,k=!1,R=!1,A=!1,I=0,N=!1,_=0,M=0,O=0,j=0,b="",m=1,g="",D=!1,L=!1}catch(e){n&&console.log("SmartPlugin :: "+l+" :: reset :: Error: "+e)}},unLoad:function(){try{clearTimeout(b),clearTimeout(V),P.sendStop(),h=0,y="",i=o.getLive(),E=0,U=0,k=!1,R=!1,I=0,N=!1,_=0,M=0,O=0,j=0,b="",m=1,g="",unbindEvents(),A="",delete P}catch(e){n&&console.log("SmartPlugin :: "+l+" :: reset :: Error: "+e)}}},r.youbora.setProperties(a),r.youbora.Init()});